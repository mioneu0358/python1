<!DOCTYPE html>
<html>
<head>
    <title>Audio Player</title>
    <style>
        .category-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
        }
    </style>
</head>
<body>
    <h1>Audio Player</h1>
    <div class="category-container">
        {% for category in categories %}
        <div>
            <h2>{{ category }}</h2>
                <form action="{{ url_for('play_audio', file_id='') }}" method="post">
                    <select name="file_id_{{category}}" id="audio_file_{{ category }}" onclick="updateAudioPlayer('{{ category }}')">
                        {% for audio_file in audio_files_data %}
                            <option value="{{ audio_file.url }}">{{ audio_file.name }}</option>
                        {% endfor %}
                    </select>
                    <br><br>
                    <div id='result'>선택값: </div>
                    <audio id="audio_player_{{ category }}" controls>
                        <source id="audio_source_{{ category }}" src="" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <br><br>
                    <label for="volume_{{ category }}">Volume:</label>
                    <input type="range" id="volume_{{ category }}" name="volume" min="0" max="100" value="50">
                    <br><br>
                    <input type="submit" value="Save Volume">
                </form>
        </div>
        {% endfor %}
    </div>
    <br><br>
    <form action="/get_volume" method="POST">
        <label for="category_load">Category:</label>
        <select id="category_load" name="category_load">
            {% for category in categories %}
                <option value="{{ category }}">{{ category }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Load Volume">
    </form>
    <script>
        // Audio file data for each category
        const audioFiles = {

                {% for file in audio_files_data %}
                    {% set sanitized_name = category|replace(' ', '_')|replace('[^a-zA-Z0-9_]', '') %}
                    {% set sanitized_category = category|replace(' ', '_')|replace('[^a-zA-Z0-9_]', '') %}
                "{{ file.name }}": "{{ file.url }}" ,
                {% endfor %}
            };


        // Update the audio player source when the audio file is changed
        function updateAudioPlayer(category) {
            const audioPlayer = document.getElementById(`audio_player_${ category }`);
            console.log(audioPlayer);
            const audioSource = document.getElementById(`audio_file_${category}`);
            console.log("audioSource",audioSource.value);
            const audioFileSelect = document.getElementById(`audio_file_${category}`);

            audioPlayer.src = audioSource.value;
            console.log("audioPlayer.src",audioPlayer.src);
            audioPlayer.load();
        }

        // Update audio file options when the category is changed
        function updateAudioFileOptions() {
            const category = this.value;
            const audioFileSelect = document.getElementById(`audio_file_${category}`);
            audioFileSelect.innerHTML = "";
            audioFiles[category].forEach(function(file) {
                const option = document.createElement("option");
                option.value = file.url;
                option.text = file.name;
                audioFileSelect.appendChild(option);
            });

            // Update the audio player source with the first audio file
            updateAudioPlayer(category);
        }

        // Add event listeners to the category selects
        const categorySelects = document.querySelectorAll("[name=category]");
        categorySelects.forEach(function(select) {
            select.addEventListener("change", updateAudioFileOptions);
        });

        // Add event listeners to the audio file selects
        const audioFileSelects = document.querySelectorAll("[name=audio_file]");
        audioFileSelects.forEach(function(select) {
            select.addEventListener("change", function() {
                const category = this.form.elements.category.value;
                updateAudioPlayer(category);
            });
        });

    </script>
</body>
</html>
